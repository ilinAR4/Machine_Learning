# Physical Therapy Exercises Classifier

## Описание проекта

**Цель проекта** — разработать систему автоматической классификации упражнений физиотерапии на основе данных с носимых инерциальных и магнитных датчиков (IMU). Модель машинного обучения предсказывает тип выполняемого упражнения из 8 возможных классов. Результаты работы оформлены в виде многостраничного Streamlit-приложения с интерактивной презентацией.

Проект предназначен для демонстрации возможностей машинного обучения в области физиотерапии и реабилитации, что позволяет:
- Автоматически распознавать упражнения пациента
- Осуществлять удаленный мониторинг реабилитации
- Оценивать корректность выполнения упражнений
- Создавать виртуальных тренеров для самостоятельных занятий

---

## Датасет

Используется датасет **"Physical Therapy Exercises Dataset"** из UCI Machine Learning Repository, содержащий данные с носимых датчиков движения при выполнении 8 типов упражнений физиотерапии.

### Основные характеристики данных:

**Параметры сбора:**
- **Субъектов:** 5 участников
- **Частота дискретизации:** 25 Hz (25 измерений в секунду)
- **Упражнений:** 8 типов
- **Варианты выполнения:** 3 (правильное, быстрое, низкоамплитудное)
- **Сенсорных блоков:** 5 MTx (XSens)
- **Файлов данных:** 440 TXT файлов
- **Размер датасета:** 45.7 MB (ZIP архив)

**Датчики (на каждом блоке):**
1. **Акселерометр (Accelerometer)** — измеряет линейное ускорение по осям X, Y, Z
2. **Гироскоп (Gyroscope)** — измеряет угловую скорость по осям X, Y, Z
3. **Магнитометр (Magnetometer)** — измеряет магнитное поле по осям X, Y, Z

**Итого:** 9 признаков на блок × 5 блоков = 45 значений на момент времени

**Позиции датчиков:**
- Правая рука (Right Arm)
- Левая рука (Left Arm)
- Правая нога (Right Leg)
- Левая нога (Left Leg)
- Грудь (Chest)

### Типы упражнений:

1. **Exercise 1 (e1)** — Сгибание рук (Arm Curl)
2. **Exercise 2 (e2)** — Боковое поднятие рук (Lateral Arm Raise)
3. **Exercise 3 (e3)** — Поднятие рук вперед (Forward Arm Raise)
4. **Exercise 4 (e4)** — Сгибание колена (Knee Flexion)
5. **Exercise 5 (e5)** — Разгибание колена (Knee Extension)
6. **Exercise 6 (e6)** — Отведение бедра (Hip Abduction)
7. **Exercise 7 (e7)** — Разгибание бедра (Hip Extension)
8. **Exercise 8 (e8)** — Приседания (Squat)

---

## Структура репозитория

```
physical_therapy_classifier/
├── app.py                      # Основной файл Streamlit-приложения (entrypoint)
├── analysis_and_model.py       # Страница с анализом данных и моделью
├── presentation.py             # Страница с интерактивной презентацией
├── requirements.txt            # Файл с зависимостями
├── README.md                   # Описание проекта
├── data/                       # Папка с данными
│   └── PhysicalTherapyExercises.zip  # Датасет (440 TXT файлов)
└── models/                     # Папка для сохранения обученных моделей
```

---

## Установка и запуск

### 1. Клонируйте репозиторий:
```bash
git clone https://github.com/yourusername/physical_therapy_classifier
cd physical_therapy_classifier
```

### 2. Установите зависимости:
```bash
pip install -r requirements.txt
```

### 3. Запустите приложение:
```bash
streamlit run app.py
```

Приложение откроется в браузере по адресу `http://localhost:8501`

---

## Функции приложения

Приложение состоит из двух основных страниц:

### 1. Анализ и модель

На этой странице пользователь может:

**Загрузка данных:**
- Загрузить ZIP архив с датасетом (440 TXT файлов)
- Использовать демо-данные для быстрого тестирования
- Настроить прореживание данных (1-10x) для ускорения обработки

**Предобработка данных:**
- Извлечение признаков из временных окон (размер окна 50 записей, перекрытие 50%)
- Вычисление статистических признаков (среднее, медиана, std, min, max, диапазон, энергия, skew, kurtosis)
- Масштабирование данных с помощью StandardScaler
- Визуализация данных и распределения классов

**Обучение моделей:**
- Одиночная модель или сравнение всех моделей одновременно
- Доступные модели:
  - Random Forest
  - Logistic Regression
  - Support Vector Machine (SVM)
  - XGBoost
  - Decision Tree
  - K-Nearest Neighbors

**Оценка моделей:**
- Метрики: Accuracy, Precision, Recall, F1-Score, Confidence
- Кросс-валидация (5-fold CV)
- Матрица ошибок (Confusion Matrix)
- Важность признаков (Feature Importance)
- Точность по каждому классу упражнений
- Полный отчет классификации

**Предсказания:**
- Ручной ввод значений 9 датчиков (акселерометр, гироскоп, магнитометр)
- Примеры значений для каждого типа упражнения
- Предсказание типа упражнения
- Вероятности для каждого класса
- Консенсус моделей (если обучено несколько)

### 2. Презентация

Интерактивная презентация проекта с использованием Reveal.js:

**Содержание:**
- Обзор проекта и описание задачи
- Характеристики датасета
- Типы упражнений физиотерапии
- Конфигурация датчиков
- Этапы работы системы
- Модели машинного обучения
- Метрики оценки
- Результаты сравнения моделей (реальные данные)
- Трудности разработки и их решения
- Выводы и перспективы

**Настройки презентации:**
- Выбор темы (11 вариантов)
- Настройка размера слайдов (для уменьшения/увеличения шрифта)
- Эффекты переходов
- Плагины (подсветка кода, поиск)

---

## Предобработка данных

### 1. Загрузка и парсинг
- Чтение 440 TXT файлов из ZIP архива
- Парсинг временных рядов с датчиков
- Извлечение меток упражнений из названий файлов

### 2. Извлечение признаков
Использует метод **скользящего окна**:
- **Размер окна:** 50 записей (2 секунды при 25 Hz)
- **Перекрытие:** 50% (шаг 25 записей = 1 секунда)
- **Признаки на каждую ось датчика:**
  - Среднее (mean)
  - Медиана (median)
  - Стандартное отклонение (std)
  - Минимум (min)
  - Максимум (max)
  - Диапазон (range)
  - Энергия (energy)
  - Асимметрия (skew)
  - Эксцесс (kurtosis)

**Итого:** ~72 признака для классификации

### 3. Обработка NaN значений
- Все NaN значения заменяются на 0.0 с помощью `np.nan_to_num()`
- Причины NaN: деление на 0, константные значения, короткие окна

### 4. Масштабирование
- Применяется `StandardScaler` для нормализации признаков
- Обеспечивает лучшую сходимость моделей

### 5. Кодирование меток (для XGBoost)
- XGBoost требует числовые метки классов
- Используется `LabelEncoder`: 'e1' → 0, 'e2' → 1, ..., 'e8' → 7
- После предсказания метки декодируются обратно

---

## Обучение моделей

В проекте реализовано **6 моделей машинного обучения**:

### 1. **Random Forest** (Случайный лес)
- ✅ Устойчивость к переобучению
- ✅ Важность признаков
- ✅ Работает с нелинейными данными
- **Точность:** 96.64%

### 2. **Logistic Regression** (Логистическая регрессия)
- ✅ Быстрое обучение
- ✅ Интерпретируемость
- ⚠️ Только линейные границы
- **Точность:** 65.30%

### 3. **Support Vector Machine (SVM)**
- ✅ Эффективен в высоких размерностях
- ✅ Хорошо разделяет похожие классы
- ⚠️ Медленное обучение на больших данных
- **Точность:** 82.65%

### 4. **XGBoost** (Gradient Boosting)
- ✅ **Лучшая точность** (97.09%)
- ✅ Высокая стабильность
- ✅ Регуляризация предотвращает переобучение
- ⚠️ Требует настройки гиперпараметров
- **Точность:** 97.09% ⭐

### 5. **Decision Tree** (Дерево решений)
- ✅ Простота интерпретации
- ✅ Быстрое обучение
- ⚠️ Склонность к переобучению
- **Точность:** 89.37%

### 6. **K-Nearest Neighbors (KNN)**
- ✅ Простой алгоритм
- ✅ Не требует обучения
- ⚠️ Медленные предсказания
- **Точность:** 84.74%

---

## Оценка моделей

### Метрики качества:

1. **Accuracy (Точность)** — доля правильных предсказаний
2. **Precision (Точность положительных)** — доля правильно предсказанных положительных примеров
3. **Recall (Полнота)** — доля найденных положительных примеров
4. **F1-Score** — гармоническое среднее Precision и Recall
5. **Confidence (Уверенность)** — средняя вероятность предсказанных классов
6. **CV Mean** — среднее значение кросс-валидации (5-fold)
7. **CV Std** — стандартное отклонение кросс-валидации

### Результаты сравнения моделей:

| Модель | Accuracy | Confidence | F1-Score | CV Mean |
|--------|----------|------------|----------|---------|
| **XGBoost** | **97.09%** | 97.38% | 0.9709 | 0.9598 |
| **Random Forest** | 96.64% | 81.26% | 0.9663 | 0.9589 |
| **Decision Tree** | 89.37% | 99.26% | 0.8939 | 0.8694 |
| **K-Nearest Neighbors** | 84.74% | 83.00% | 0.8460 | 0.8133 |
| **SVM** | 82.65% | 81.76% | 0.8242 | 0.7980 |
| **Logistic Regression** | 65.30% | 62.70% | 0.6515 | 0.6327 |

**🏆 Победитель: XGBoost с точностью 97.09%**

---

## Оптимизация производительности

### Проблема:
Загрузка полного датасета (440 TXT файлов, 45.7 MB) занимала **3-5 минут** без оптимизации.

### Решения:

1. **Прореживание данных** (критичное решение)
   - Пользователь выбирает коэффициент прореживания (1-10x)
   - sample_rate=10 → берётся каждая 10-я запись → ускорение в 10 раз
   - Время загрузки: **20-30 секунд** вместо 3-5 минут
   - Точность остаётся достаточной: **90-92%** (подходит для сравнения моделей)

2. **Батчинг данных**
   - Обработка по 10,000 записей за раз
   - Снижение нагрузки на память

3. **Прогресс-бар**
   - Пользователь видит процесс загрузки
   - Отображается количество обработанных файлов

4. **Кэширование** (`@st.cache_data`)
   - Результаты загрузки сохраняются в памяти
   - Повторная загрузка мгновенна

---

## Streamlit-приложение

Приложение реализовано с использованием библиотеки **Streamlit**, которая позволяет быстро создавать интерактивные веб-приложения на Python.

### Основные преимущества Streamlit:
- Простота использования
- Быстрая разработка
- Множество встроенных виджетов
- Поддержка визуализации данных
- Управление состоянием (session_state)

### Реализованные функции:
- Загрузка и отображение данных
- Предобработка с прогресс-баром
- Обучение и оценка моделей
- Визуализация результатов (матрицы ошибок, графики)
- Предсказание на новых данных
- Интерактивная презентация с Reveal.js

---

## Используемые библиотеки

```
streamlit==1.41.0           # Веб-интерфейс
pandas==2.2.3               # Работа с данными
numpy==2.1.3                # Численные вычисления
scikit-learn==1.5.2         # Модели машинного обучения
matplotlib==3.9.2           # Визуализация
seaborn==0.13.2             # Красивые графики
xgboost==2.1.2              # Градиентный бустинг
scipy==1.14.1               # Научные вычисления (skew, kurtosis)
plotly==5.24.1              # Интерактивные графики
streamlit-reveal-slides==1.0.1  # Презентации
```

---

## Выводы и перспективы

### ✅ Достигнутые результаты:
- Высокая точность классификации: **97.09%** (XGBoost)
- Система работает в реальном времени (~15 мс на предсказание)
- Удобный веб-интерфейс с подробной визуализацией
- Сравнение 6 моделей машинного обучения
- Оптимизация производительности (ускорение в 10 раз)

### Возможные улучшения:
- Расширение датасета (больше участников)
- Добавление оценки качества выполнения упражнений
- Детекция аномалий и неправильной техники
- Интеграция с мобильными приложениями
- Real-time мониторинг через Bluetooth датчики
- Персонализация моделей под каждого пациента
- Клиническая валидация с реальными пациентами

### Применение:
- Физиотерапевтические центры
- Домашняя реабилитация
- Фитнес-трекеры
- Виртуальные тренеры
- Телемедицина

---

## Контакты

**Автор проекта:** [Александр]  
<<<<<<< HEAD
- GitHub: [ https://github.com/ilinAR4/predictive_maintenance_project ]
=======
- GitHub: [ https://github.com/ilinAR4/Machine_Learning ]
>>>>>>> 91bbd9f10a2c3bc8f1c5052f5bb256fd6278f709
- Email: [ khabir-ex@mail.ru ]


---

## Благодарности

- UCI Machine Learning Repository за предоставление датасета
- Разработчикам Streamlit за отличный фреймворк
- Сообществу scikit-learn и XGBoost за мощные инструменты ML

---

<<<<<<< HEAD
**⭐ Если проект был полезен, поставьте звезду на GitHub!**
=======
**⭐ Если проект был полезен, поставьте звезду на GitHub!**
>>>>>>> 91bbd9f10a2c3bc8f1c5052f5bb256fd6278f709
